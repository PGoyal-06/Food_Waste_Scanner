<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>Food Waste Scanner</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="theme-toggle form-check form-switch">
    <input class="form-check-input" type="checkbox" id="darkModeSwitch" />
    <label class="form-check-label" for="darkModeSwitch">🌙 Dark Mode</label>
  </div>

  <div class="container">
    <h1 class="mb-4">🥕 Food Waste Scanner</h1>

    <div class="card shadow mb-4">
      <div class="card-body">
        <form method="POST" onsubmit="showSpinner()">
          <div class="mb-3">
            <label for="recipe" class="form-label">Paste or speak your ingredients:</label>
            <textarea name="recipe" id="recipe" class="form-control" rows="6" required placeholder="e.g., 1 bunch cilantro, tomato paste, Greek yogurt..."></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Analyze</button>
          <button type="button" class="btn btn-secondary ms-2" onclick="startListening()">🎙️ Speak Ingredients</button>
        </form>
      </div>
    </div>

    <div id="loadingSpinner" class="text-center mb-4">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">Analyzing your recipe...</p>
    </div>

    {% if result %}
    <div class="card shadow mb-4">
      <div class="card-body">
        <h3 class="card-title">🔍 Analysis Results</h3>
        <div class="list-group mt-3">
          {% for item in result %}
          <div class="list-group-item">
            <h5 class="mb-1">
              {{ item.ingredient }}
              {% if item.waste_risk.lower() == "high" %}
              <span class="badge badge-high ms-2">High Risk</span>
              {% elif item.waste_risk.lower() == "medium" %}
              <span class="badge badge-medium ms-2">Medium Risk</span>
              {% else %}
              <span class="badge badge-low ms-2">Low Risk</span>
              {% endif %}
            </h5>
            <p class="mb-1"><strong>Reason:</strong> {{ item.reason }}</p>
            <p class="mb-0">
              <strong>Suggestion:</strong> {{ item.suggestion }}
              <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="speak('{{ item.suggestion }}')">🔊</button>
            </p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

    <div class="card shadow mb-5">
      <div class="card-body">
        <h3 class="card-title mb-3">🤖 Ask the Kitchen Assistant</h3>
        <div id="chat-box" class="chat-container mb-3"></div>
        <div class="input-group">
          <input type="text" id="chatInput" class="form-control" placeholder="e.g., What can I do with extra parsley?" />
          <button class="btn btn-outline-primary" type="button" onclick="sendChat()">Send</button>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
